<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Loading… | Tabularis Blog</title>
        <meta name="description" content="Tabularis Blog — release notes and updates." />

        <!-- Open Graph (updated dynamically by JS once the post loads) -->
        <meta property="og:type" content="article" />
        <meta property="og:site_name" content="Tabularis Blog" />
        <meta id="og-url" property="og:url" content="https://tabularis.dev/blog/" />
        <meta id="og-title" property="og:title" content="Tabularis Blog" />
        <meta id="og-description" property="og:description" content="Release notes and updates from the Tabularis project." />
        <meta id="og-image" property="og:image" content="https://raw.githubusercontent.com/debba/tabularis/main/website/img/og.png" />

        <!-- Twitter -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta id="tw-title" name="twitter:title" content="Tabularis Blog" />
        <meta id="tw-description" name="twitter:description" content="Release notes and updates from the Tabularis project." />
        <meta id="tw-image" name="twitter:image" content="https://raw.githubusercontent.com/debba/tabularis/main/website/img/og.png" />

        <link rel="icon" type="image/png" href="../img/logo.png" />
        <style>
            :root {
                --bg-color: #0d1117;
                --card-bg: #161b22;
                --text-main: #c9d1d9;
                --text-muted: #8b949e;
                --accent: #58a6ff;
                --border: #30363d;
                --font-stack:
                    ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas,
                    "Liberation Mono", monospace;
                --max-width: 720px;
            }

            * { box-sizing: border-box; margin: 0; padding: 0; }

            body {
                background-color: var(--bg-color);
                color: var(--text-main);
                font-family: var(--font-stack);
                line-height: 1.6;
                padding: 2rem 1rem;
                font-size: 16px;
            }

            .container { max-width: var(--max-width); margin: 0 auto; }

            a { color: var(--accent); text-decoration: none; }
            a:hover { text-decoration: underline; }

            /* HEADER NAV */
            .site-header {
                border-bottom: 1px solid var(--border);
                padding-bottom: 1.5rem;
                margin-bottom: 3rem;
                display: flex;
                align-items: center;
                gap: 1rem;
                flex-wrap: wrap;
            }

            .site-header .back-link {
                font-size: 0.85rem;
                color: var(--text-muted);
            }
            .site-header .back-link:hover { color: var(--accent); text-decoration: none; }
            .site-header .sep { color: var(--border); }
            .site-header .crumb { font-size: 0.85rem; color: var(--text-muted); }

            .header-links {
                margin-left: auto;
                display: flex;
                gap: 1rem;
                align-items: center;
                font-size: 0.82rem;
            }
            .header-links a { color: var(--text-muted); }
            .header-links a:hover { color: var(--accent); text-decoration: none; }

            /* LOADING / ERROR */
            #status { color: var(--text-muted); font-size: 0.9rem; padding: 2rem 0; }

            /* POST PROSE */
            #post-content { line-height: 1.75; }

            #post-content h1 {
                font-size: 1.9rem;
                font-weight: 700;
                color: #fff;
                margin-bottom: 1rem;
                letter-spacing: -0.5px;
                line-height: 1.2;
            }

            #post-content h2 {
                font-size: 1.2rem;
                font-weight: 600;
                color: var(--text-main);
                border-bottom: 1px solid var(--border);
                padding-bottom: 0.4rem;
                margin: 2.5rem 0 1rem;
            }

            #post-content h3 {
                font-size: 1rem;
                font-weight: 600;
                color: var(--accent);
                margin: 2rem 0 0.5rem;
            }

            #post-content p { margin-bottom: 1.1rem; color: var(--text-main); }

            #post-content ul,
            #post-content ol { margin: 0 0 1.1rem 1.5rem; }

            #post-content li { margin-bottom: 0.35rem; }

            #post-content strong { color: #fff; }

            #post-content code {
                background-color: rgba(110, 118, 129, 0.4);
                padding: 0.2em 0.4em;
                border-radius: 4px;
                font-size: 85%;
                font-family: var(--font-stack);
            }

            #post-content pre {
                background-color: var(--card-bg);
                padding: 1rem;
                border-radius: 6px;
                border: 1px solid var(--border);
                overflow-x: auto;
                margin-bottom: 1.5rem;
            }

            #post-content pre code {
                background: none;
                padding: 0;
                border-radius: 0;
                font-size: 0.88rem;
                color: var(--text-main);
            }

            #post-content blockquote {
                border-left: 3px solid var(--border);
                padding-left: 1rem;
                color: var(--text-muted);
                margin-bottom: 1.1rem;
            }

            #post-content hr { border: none; border-top: 1px solid var(--border); margin: 2rem 0; }

            #post-content img {
                width: 100%;
                border-radius: 6px;
                border: 1px solid var(--border);
                display: block;
                margin: 1.5rem 0 0.4rem;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            }

            /* Image caption: markdown italic-only paragraph after an image */
            #post-content img + p > em:only-child {
                display: block;
                font-size: 0.78rem;
                color: var(--text-muted);
                text-align: center;
                margin-bottom: 1.5rem;
                font-style: normal;
            }

            #post-content a { color: var(--accent); }

            /* POST META BAR */
            .post-meta {
                display: flex;
                align-items: center;
                gap: 0.6rem;
                font-size: 0.78rem;
                color: var(--text-muted);
                margin: 0.75rem 0 2.5rem;
                flex-wrap: wrap;
            }

            .post-release {
                font-size: 0.68rem;
                padding: 0.1rem 0.5rem;
                border-radius: 2rem;
                background: rgba(88, 166, 255, 0.12);
                border: 1px solid rgba(88, 166, 255, 0.3);
                color: var(--accent);
                letter-spacing: 0.02em;
            }

            .post-tag {
                font-size: 0.68rem;
                padding: 0.1rem 0.5rem;
                border-radius: 2rem;
                background: rgba(139, 148, 158, 0.1);
                border: 1px solid var(--border);
                color: var(--text-muted);
            }

            /* SHARE + CTA BLOCK */
            .post-footer-cta {
                margin-top: 3rem;
                padding: 1.5rem;
                background: var(--card-bg);
                border: 1px solid var(--border);
                border-radius: 6px;
            }

            .post-footer-cta p {
                font-size: 0.9rem;
                color: var(--text-muted);
                margin-bottom: 1rem;
            }

            .cta-links {
                display: flex;
                gap: 0.75rem;
                flex-wrap: wrap;
            }

            .btn-cta {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.45rem 0.9rem;
                border: 1px solid var(--border);
                border-radius: 6px;
                color: var(--text-muted);
                font-size: 0.82rem;
                transition: all 0.2s;
                font-family: var(--font-stack);
            }
            .btn-cta:hover { border-color: var(--accent); color: var(--accent); text-decoration: none; }
            .btn-cta.discord:hover { border-color: #5865f2; color: #5865f2; }

            /* SHARE BUTTON */
            .btn-share {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.45rem 0.9rem;
                border: 1px solid var(--border);
                border-radius: 6px;
                color: var(--text-muted);
                font-size: 0.82rem;
                background: transparent;
                cursor: pointer;
                transition: all 0.2s;
                font-family: var(--font-stack);
            }
            .btn-share:hover { border-color: var(--text-muted); color: var(--text-main); }
            .btn-share.copied { border-color: #238636; color: #3fb950; }

            /* FOOTER */
            footer {
                margin-top: 4rem;
                border-top: 1px solid var(--border);
                padding-top: 2rem;
                text-align: center;
                font-size: 0.85rem;
                color: var(--text-muted);
            }
        </style>
    </head>
    <body>
        <div class="container">
            <header class="site-header">
                <a href="../index.html" class="back-link">← tabularis</a>
                <span class="sep">/</span>
                <a href="index.html" class="crumb">blog</a>
                <span class="sep">/</span>
                <span class="crumb" id="breadcrumb-title">post</span>
                <div class="header-links">
                    <a href="https://github.com/debba/tabularis">GitHub</a>
                    <a href="https://discord.gg/YrZPHAwMSG">Discord</a>
                </div>
            </header>

            <div id="status">Loading…</div>
            <article id="post-content" style="display:none"></article>

            <div id="post-cta" style="display:none" class="post-footer-cta">
                <p>Enjoyed this post? Try Tabularis, star the repo, or join the community.</p>
                <div class="cta-links">
                    <a class="btn-cta" href="https://github.com/debba/tabularis">
                        <svg width="15" height="15" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/></svg>
                        Star on GitHub
                    </a>
                    <a class="btn-cta discord" href="https://discord.gg/YrZPHAwMSG">
                        <svg width="15" height="15" viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
                        Join Discord
                    </a>
                    <button class="btn-share" id="share-btn" onclick="sharePost()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                        Copy link
                    </button>
                </div>
            </div>

            <footer>
                <p>
                    &copy; 2026 Tabularis Project &mdash;
                    <a href="../index.html">tabularis.dev</a> &middot;
                    <a href="https://github.com/debba/tabularis">GitHub</a> &middot;
                    <a href="https://discord.gg/YrZPHAwMSG">Discord</a>
                </p>
            </footer>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <script>
            var postTitle = "";
            var postExcerpt = "";

            function sharePost() {
                var btn = document.getElementById("share-btn");
                navigator.clipboard.writeText(window.location.href).then(function () {
                    btn.textContent = "Copied!";
                    btn.classList.add("copied");
                    setTimeout(function () {
                        btn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg> Copy link';
                        btn.classList.remove("copied");
                    }, 2000);
                });
            }

            (function () {
                var params = new URLSearchParams(window.location.search);
                var slug = params.get("slug");

                if (!slug || !/^[a-z0-9-]+$/.test(slug)) {
                    document.getElementById("status").textContent = "No post specified.";
                    return;
                }

                fetch("posts/" + slug + ".md")
                    .then(function (res) {
                        if (!res.ok) throw new Error("Post not found (" + res.status + ")");
                        return res.text();
                    })
                    .then(function (raw) {
                        // Parse YAML front matter
                        var frontMatter = {};
                        var body = raw;
                        var fmMatch = raw.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);
                        if (fmMatch) {
                            fmMatch[1].split("\n").forEach(function (line) {
                                var idx = line.indexOf(":");
                                if (idx === -1) return;
                                var key = line.slice(0, idx).trim();
                                var val = line.slice(idx + 1).trim().replace(/^["']|["']$/g, "");
                                frontMatter[key] = val;
                            });
                            body = fmMatch[2];
                        }

                        // Parse tags
                        var tags = [];
                        if (frontMatter.tags) {
                            tags = frontMatter.tags
                                .replace(/^\[|\]$/g, "")
                                .split(",")
                                .map(function (t) { return t.trim(); })
                                .filter(Boolean);
                        }

                        // Render markdown
                        var html = marked.parse(body);

                        // Extract title from first h1
                        var titleMatch = html.match(/<h1[^>]*>([\s\S]*?)<\/h1>/);
                        postTitle = titleMatch ? titleMatch[1].replace(/<[^>]+>/g, "") : slug;
                        postExcerpt = frontMatter.excerpt || "";

                        // Update page <title>
                        document.title = postTitle + " | Tabularis Blog";

                        // Update OG / Twitter meta tags dynamically
                        var pageUrl = "https://tabularis.dev/blog/post.html?slug=" + slug;
                        document.getElementById("og-url").setAttribute("content", pageUrl);
                        document.getElementById("og-title").setAttribute("content", postTitle + " | Tabularis Blog");
                        document.getElementById("tw-title").setAttribute("content", postTitle + " | Tabularis Blog");
                        if (postExcerpt) {
                            document.getElementById("og-description").setAttribute("content", postExcerpt);
                            document.getElementById("tw-description").setAttribute("content", postExcerpt);
                            document.querySelector("meta[name='description']").setAttribute("content", postExcerpt);
                        }
                        // Per-post OG image (place generated PNGs in blog/img/)
                        var ogImageUrl = "https://tabularis.dev/blog/img/og-" + slug + ".png";
                        document.getElementById("og-image").setAttribute("content", ogImageUrl);
                        document.getElementById("tw-image").setAttribute("content", ogImageUrl);

                        // Breadcrumb
                        var crumb = document.getElementById("breadcrumb-title");
                        crumb.textContent = postTitle.length > 40 ? postTitle.slice(0, 40) + "…" : postTitle;

                        // Format ISO date → "Feb 23, 2026"
                        function fmtDate(iso) {
                            var d = new Date(iso + "T12:00:00Z");
                            return d.toLocaleDateString("en-US", { year: "numeric", month: "short", day: "numeric", timeZone: "UTC" });
                        }

                        // Build meta bar
                        var metaParts = [];
                        if (frontMatter.date) metaParts.push("<span>" + fmtDate(frontMatter.date) + "</span><span>·</span><span>2 min read</span>");
                        if (frontMatter.release) metaParts.push("<span class='post-release'>" + frontMatter.release + "</span>");
                        tags.forEach(function (t) { metaParts.push("<span class='post-tag'>" + t + "</span>"); });
                        var metaBar = "<div class='post-meta'>" + metaParts.join("<span>&middot;</span>") + "</div>";

                        // Inject meta bar after first h1
                        html = html.replace(/<\/h1>/, "</h1>" + metaBar);

                        var article = document.getElementById("post-content");
                        article.innerHTML = html;
                        article.style.display = "block";
                        document.getElementById("status").style.display = "none";
                        document.getElementById("post-cta").style.display = "block";
                    })
                    .catch(function (err) {
                        document.getElementById("status").textContent =
                            "Could not load post: " + err.message;
                    });
            })();
        </script>
    </body>
</html>
